<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Login</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins", sans-serif; }
  body {
    height:100vh; display:flex; justify-content:center; align-items:center;
    background:linear-gradient(135deg, #4A00E0, #8E2DE2); color:white; position:relative;
  }
  .login-box {
    position:relative; width:350px; padding:40px; background:rgba(255,255,255,0.1);
    backdrop-filter:blur(10px); border-radius:12px; box-shadow:0 8px 25px rgba(0,0,0,0.2); text-align:center;
    transition: transform 0.2s;
  }
  .login-box.shake {
    animation: shake 0.3s;
  }
  @keyframes shake {
    0% { transform: translateX(0); }
    20% { transform: translateX(-10px); }
    40% { transform: translateX(10px); }
    60% { transform: translateX(-10px); }
    80% { transform: translateX(10px); }
    100% { transform: translateX(0); }
  }
  .login-box h2 { margin-bottom:20px; font-weight:600; font-size:26px; }
  .input-group { margin-top:15px; text-align:left; position:relative; }
  .input-group label { font-size:14px; font-weight:400; }
  .input-group input {
    width:100%; padding:12px; border:none; border-radius:8px; margin-top:5px; outline:none; font-size:15px; background:white;
  }
  .toggle-password {
    position:absolute; right:12px; top:38px; cursor:pointer; font-size:14px; color:#4A00E0;
    user-select:none;
  }
  button {
    margin-top:25px; width:100%; padding:12px; border:none; border-radius:8px;
    background:#ffffff; color:#4A00E0; font-weight:600; font-size:16px; cursor:pointer; transition:0.3s;
  }
  button:hover { background:#e6e6e6; }
  .error { margin-top:12px; color:#ffaaaa; font-size:14px; display:none; }
  .success-msg {
    position:absolute; top:-40px; left:50%; transform:translateX(-50%);
    background:#00FF7F; color:#000; padding:8px 16px; border-radius:8px;
    font-weight:600; display:none; animation:fadeOut 2s forwards;
  }
  @keyframes fadeOut {
    0% { opacity:1; }
    80% { opacity:1; }
    100% { opacity:0; transform:translate(-50%, -60px); }
  }
</style>
</head>
<body>

<div class="login-box" id="loginBox">
  <h2>Welcome Back</h2>

  <div class="input-group">
    <label>Username</label>
    <input type="text" id="username" placeholder="Enter username" />
  </div>

  <div class="input-group">
    <label>Password</label>
    <input type="password" id="password" placeholder="Enter password" />
    <span class="toggle-password" id="togglePassword">Show</span>
  </div>

  <button id="loginBtn">Log In</button>

  <p class="error" id="errorMsg">Invalid username or password</p>
  <div class="success-msg" id="successMsg">Login Successful!</div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwIQ30msaS39Y0ntzTYURgEs7P-l7L8VYOmqZ2gDG04eQiHlOPkqKThJU5tGQLH7CsH/exec"; // Apps Script Web App URL
const dashboardURL = "https://projectsfrombossjoel.github.io/dashboard-report/dashboard";

const loginBtn = document.getElementById("loginBtn");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const errorMsg = document.getElementById("errorMsg");
const successMsg = document.getElementById("successMsg");
const togglePassword = document.getElementById("togglePassword");
const loginBox = document.getElementById("loginBox");

// Toggle password visibility
togglePassword.addEventListener("click", () => {
  if (passwordInput.type === "password") {
    passwordInput.type = "text";
    togglePassword.textContent = "Hide";
  } else {
    passwordInput.type = "password";
    togglePassword.textContent = "Show";
  }
});

// Shake animation for error
function shakeLoginBox() {
  loginBox.classList.add("shake");
  setTimeout(() => loginBox.classList.remove("shake"), 300);
}

// Login function
async function login() {
  const username = usernameInput.value.trim();
  const password = passwordInput.value.trim();
  errorMsg.style.display = "none";

  if (!username || !password) {
    errorMsg.textContent = "Please fill in both fields.";
    errorMsg.style.display = "block";
    shakeLoginBox();
    return;
  }

  try {
    const res = await fetch(scriptURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const text = await res.text();
    console.log("Server Response:", text);
    const data = JSON.parse(text);

    if (data.success) {
      successMsg.style.display = "block";
      setTimeout(() => {
        window.location.href = dashboardURL;
      }, 1500);
    } else {
      errorMsg.textContent = "Invalid username or password.";
      errorMsg.style.display = "block";
      shakeLoginBox();
    }

  } catch (err) {
    errorMsg.textContent = "Login failed. Please try again later.";
    errorMsg.style.display = "block";
    shakeLoginBox();
    console.error(err);
  }
}

// Click button or press Enter key
loginBtn.addEventListener("click", login);
document.addEventListener("keydown", function(e){
  if(e.key === "Enter") login();
});
</script>

</body>
</html>
